{% extends "base.html" %}

{% block title %}Network Health Overview - HomeNetMon{% endblock %}

{% block content %}
<div id="health-overview-container">
    
    <!-- Critical Alerts Banner -->
    <div id="critical-alerts-banner" class="alert alert-danger alert-dismissible mb-3" style="display: none;">
        <div class="d-flex align-items-center">
            <div class="me-3">
                <i class="bi bi-exclamation-triangle-fill fs-4 text-danger animate-pulse"></i>
            </div>
            <div class="flex-grow-1">
                <h5 class="alert-heading mb-1">
                    <span id="critical-alert-count">0</span> Critical Alert(s) Require Attention
                </h5>
                <p class="mb-0" id="critical-alert-message">Network issues detected that need immediate attention.</p>
            </div>
            <div class="ms-3">
                <button type="button" class="btn btn-outline-danger btn-sm me-2" onclick="viewAllAlerts()">
                    <i class="bi bi-eye"></i> View All
                </button>
                <button type="button" class="btn-close" onclick="dismissCriticalBanner()"></button>
            </div>
        </div>
    </div>

    <!-- Main Health Dashboard -->
    <div class="row g-4 mb-4">
        
        <!-- Hero Health Score -->
        <div class="col-lg-5">
            <div class="card h-100 border-0 shadow-sm health-hero-card">
                <div class="card-body d-flex align-items-center justify-content-center">
                    <div class="text-center">
                        <div class="position-relative d-inline-block mb-3">
                            <!-- Animated Health Circle -->
                            <div id="health-circle" class="health-score-circle">
                                <svg width="200" height="200" class="health-circle-svg">
                                    <circle class="health-circle-bg" cx="100" cy="100" r="90" 
                                            stroke="#e9ecef" stroke-width="8" fill="none"/>
                                    <circle id="health-circle-progress" class="health-circle-progress" 
                                            cx="100" cy="100" r="90" stroke="#28a745" stroke-width="8" 
                                            fill="none" stroke-linecap="round" 
                                            stroke-dasharray="565.5" stroke-dashoffset="565.5"
                                            transform="rotate(-90 100 100)"/>
                                </svg>
                                <div class="health-score-content">
                                    <div id="health-score-value" class="health-score-number">--</div>
                                    <div class="health-score-label">Health Score</div>
                                    <div class="network-pulse">
                                        <div class="pulse-dot"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h4 id="health-status-text" class="mb-2">Calculating...</h4>
                        <p id="health-status-message" class="text-muted mb-0">Loading network status...</p>
                        <div class="mt-3">
                            <small class="text-muted">Last updated: <span id="last-updated-time">--</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Status Grid -->
        <div class="col-lg-7">
            <div class="row g-3 h-100">
                
                <!-- Devices Online -->
                <div class="col-6">
                    <div class="card h-100 border-0 shadow-sm status-metric-card" data-metric="online">
                        <div class="card-body text-center">
                            <div class="metric-icon text-success mb-2">
                                <i class="bi bi-wifi fs-1"></i>
                            </div>
                            <div class="metric-value text-success" id="devices-online-count">--</div>
                            <div class="metric-label">Devices Online</div>
                            <div class="metric-percentage text-muted" id="devices-online-percentage">--</div>
                        </div>
                    </div>
                </div>

                <!-- Devices Offline -->
                <div class="col-6">
                    <div class="card h-100 border-0 shadow-sm status-metric-card" data-metric="offline">
                        <div class="card-body text-center">
                            <div class="metric-icon text-danger mb-2">
                                <i class="bi bi-wifi-off fs-1"></i>
                            </div>
                            <div class="metric-value text-danger" id="devices-offline-count">--</div>
                            <div class="metric-label">Devices Offline</div>
                            <div class="metric-trend" id="devices-offline-trend">--</div>
                        </div>
                    </div>
                </div>

                <!-- Average Response Time -->
                <div class="col-6">
                    <div class="card h-100 border-0 shadow-sm status-metric-card" data-metric="response">
                        <div class="card-body text-center">
                            <div class="metric-icon text-primary mb-2">
                                <i class="bi bi-speedometer2 fs-1"></i>
                            </div>
                            <div class="metric-value text-primary">
                                <span id="avg-response-time">--</span><small class="metric-unit">ms</small>
                            </div>
                            <div class="metric-label">Avg Response</div>
                            <div class="metric-sparkline">
                                <canvas id="response-sparkline" width="100" height="30"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Network Uptime -->
                <div class="col-6">
                    <div class="card h-100 border-0 shadow-sm status-metric-card" data-metric="uptime">
                        <div class="card-body text-center">
                            <div class="metric-icon text-info mb-2">
                                <i class="bi bi-graph-up-arrow fs-1"></i>
                            </div>
                            <div class="metric-value text-info">
                                <span id="network-uptime">--</span><small class="metric-unit">%</small>
                            </div>
                            <div class="metric-label">24h Uptime</div>
                            <div class="metric-bar">
                                <div class="uptime-bar">
                                    <div id="uptime-bar-fill" class="uptime-bar-fill"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Network Topology and Activity Feed -->
    <div class="row g-4 mb-4">
        
        <!-- Network Topology Mini-Map -->
        <div class="col-lg-7">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 pb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-diagram-3 me-2"></i>Network Topology
                        </h5>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary" onclick="refreshTopology()">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                            <button class="btn btn-outline-primary" onclick="toggleTopologyLayout()">
                                <i class="bi bi-grid-3x3-gap"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="network-topology-container" class="topology-container">
                        <div class="topology-loading text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="mt-2 text-muted">Loading network topology...</div>
                        </div>
                        <div id="network-topology" class="network-topology"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-Time Activity Feed -->
        <div class="col-lg-5">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 pb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-activity me-2"></i>Live Activity Feed
                        </h5>
                        <div class="activity-status">
                            <span class="badge bg-success activity-pulse">Live</span>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div id="activity-feed" class="activity-feed">
                        <div class="activity-loading text-center py-4">
                            <div class="spinner-border spinner-border-sm text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="mt-2 small text-muted">Loading activity...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Metrics Row -->
    <div class="row g-4">
        
        <!-- Bandwidth Usage -->
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="metric-icon text-purple mb-2">
                        <i class="bi bi-bar-chart-line fs-1"></i>
                    </div>
                    <div class="metric-value text-purple">
                        <div>↓ <span id="download-speed">--</span> Mbps</div>
                        <div>↑ <span id="upload-speed">--</span> Mbps</div>
                    </div>
                    <div class="metric-label">Bandwidth Usage</div>
                </div>
            </div>
        </div>

        <!-- Active Alerts -->
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="metric-icon text-warning mb-2">
                        <i class="bi bi-exclamation-triangle fs-1"></i>
                    </div>
                    <div class="metric-value text-warning" id="active-alerts-count">--</div>
                    <div class="metric-label">Active Alerts</div>
                    <div class="mt-2">
                        <button class="btn btn-outline-warning btn-sm" onclick="viewAllAlerts()">
                            View All
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="metric-icon text-secondary mb-2">
                        <i class="bi bi-gear fs-1"></i>
                    </div>
                    <div class="metric-label mb-3">Quick Actions</div>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="triggerNetworkScan()">
                            <i class="bi bi-search me-1"></i> Network Scan
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="pingAllDevices()">
                            <i class="bi bi-broadcast me-1"></i> Ping All
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- WebSocket Connection Status -->
<div id="connection-status" class="position-fixed bottom-0 end-0 me-3 mb-3" style="z-index: 1000;">
    <div class="badge bg-success connection-indicator">
        <i class="bi bi-wifi"></i> Connected
    </div>
</div>

<script>
// Health Overview Dashboard JavaScript
class HealthOverviewDashboard {
    constructor() {
        this.socket = null;
        this.refreshInterval = null;
        this.isConnected = false;
        this.charts = {};
        
        this.init();
    }

    init() {
        // Initialize dashboard
        this.setupWebSocket();
        this.loadHealthData();
        this.setupEventListeners();
        this.startAutoRefresh();
        
        // Load initial data
        this.refreshAll();
    }

    setupWebSocket() {
        if (typeof io !== 'undefined') {
            this.socket = io();
            
            this.socket.on('connect', () => {
                this.isConnected = true;
                this.updateConnectionStatus(true);
                console.log('WebSocket connected');
            });

            this.socket.on('disconnect', () => {
                this.isConnected = false;
                this.updateConnectionStatus(false);
                console.log('WebSocket disconnected');
            });

            // Listen for real-time updates
            this.socket.on('health_update', (data) => {
                this.updateHealthData(data);
            });

            this.socket.on('device_status_update', () => {
                this.refreshHealthScore();
            });
        }
    }

    updateConnectionStatus(connected) {
        const indicator = document.getElementById('connection-status');
        if (connected) {
            indicator.innerHTML = '<div class="badge bg-success connection-indicator"><i class="bi bi-wifi"></i> Connected</div>';
        } else {
            indicator.innerHTML = '<div class="badge bg-danger connection-indicator"><i class="bi bi-wifi-off"></i> Disconnected</div>';
        }
    }

    async loadHealthData() {
        try {
            const response = await fetch('/api/health/overview');
            const data = await response.json();
            
            if (data.success) {
                this.updateHealthData(data);
            } else {
                console.error('Failed to load health data:', data.error);
                this.showError('Failed to load network health data');
            }
        } catch (error) {
            console.error('Error loading health data:', error);
            this.showError('Network error loading health data');
        }
    }

    updateHealthData(data) {
        // Update health score
        this.updateHealthScore(data.health_score, data.status_summary);
        
        // Update network status metrics
        this.updateNetworkMetrics(data.network_status);
        
        // Update alerts
        this.updateAlerts(data.alerts);
        
        // Update bandwidth
        this.updateBandwidth(data.bandwidth);
        
        // Update activity feed
        this.updateActivityFeed(data.recent_activity);
        
        // Update last updated time
        const lastUpdated = new Date().toLocaleTimeString();
        document.getElementById('last-updated-time').textContent = lastUpdated;
    }

    updateHealthScore(score, statusSummary) {
        // Animate the circular progress
        const circle = document.getElementById('health-circle-progress');
        const scoreElement = document.getElementById('health-score-value');
        const statusText = document.getElementById('health-status-text');
        const statusMessage = document.getElementById('health-status-message');
        
        // Calculate stroke-dashoffset for percentage
        const circumference = 2 * Math.PI * 90; // radius = 90
        const offset = circumference - (score / 100) * circumference;
        
        // Animate the circle
        circle.style.transition = 'stroke-dashoffset 1.5s ease-in-out, stroke 0.5s ease';
        circle.style.strokeDashoffset = offset;
        
        // Update colors based on score
        let color = '#28a745'; // green
        if (score < 60) color = '#dc3545'; // red
        else if (score < 75) color = '#ffc107'; // yellow
        
        circle.style.stroke = color;
        
        // Animate the score number
        this.animateNumber(scoreElement, parseFloat(scoreElement.textContent) || 0, score, 1500);
        
        // Update status
        if (statusSummary) {
            statusText.textContent = statusSummary.message;
            statusText.className = `mb-2 text-${statusSummary.color}`;
            statusMessage.textContent = `Network Health: ${statusSummary.status.toUpperCase()}`;
        }
    }

    updateNetworkMetrics(metrics) {
        // Devices online
        document.getElementById('devices-online-count').textContent = metrics.devices_online;
        document.getElementById('devices-online-percentage').textContent = `${metrics.online_percentage}% of ${metrics.total_devices}`;
        
        // Devices offline
        document.getElementById('devices-offline-count').textContent = metrics.devices_offline;
        
        // Response time
        document.getElementById('avg-response-time').textContent = metrics.avg_response_time_ms;
        
        // Uptime
        const uptimeElement = document.getElementById('network-uptime');
        const uptimeBar = document.getElementById('uptime-bar-fill');
        
        uptimeElement.textContent = metrics.uptime_percentage_24h;
        uptimeBar.style.width = `${metrics.uptime_percentage_24h}%`;
        
        // Color code uptime bar
        if (metrics.uptime_percentage_24h >= 95) uptimeBar.style.backgroundColor = '#28a745';
        else if (metrics.uptime_percentage_24h >= 85) uptimeBar.style.backgroundColor = '#ffc107';
        else uptimeBar.style.backgroundColor = '#dc3545';
    }

    updateAlerts(alerts) {
        // Critical alerts banner
        const banner = document.getElementById('critical-alerts-banner');
        const countElement = document.getElementById('critical-alert-count');
        
        if (alerts.has_critical) {
            banner.style.display = 'block';
            countElement.textContent = alerts.critical_count;
        } else {
            banner.style.display = 'none';
        }
        
        // Active alerts count
        document.getElementById('active-alerts-count').textContent = alerts.total_active;
    }

    updateBandwidth(bandwidth) {
        document.getElementById('download-speed').textContent = bandwidth.download_mbps || '--';
        document.getElementById('upload-speed').textContent = bandwidth.upload_mbps || '--';
    }

    updateActivityFeed(activities) {
        const feed = document.getElementById('activity-feed');
        
        if (!activities || activities.length === 0) {
            feed.innerHTML = '<div class="text-center py-4 text-muted">No recent activity</div>';
            return;
        }
        
        const activityHTML = activities.map(activity => {
            const timeAgo = this.timeAgo(new Date(activity.timestamp));
            const iconClass = this.getActivityIcon(activity.type, activity.severity);
            const severityClass = this.getSeverityClass(activity.severity);
            
            return `
                <div class="activity-item">
                    <div class="activity-icon ${severityClass}">
                        <i class="bi bi-${iconClass}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-message">${activity.message}</div>
                        <div class="activity-time">${timeAgo}</div>
                    </div>
                </div>
            `;
        }).join('');
        
        feed.innerHTML = activityHTML;
    }

    animateNumber(element, start, end, duration) {
        const startTime = performance.now();
        const diff = end - start;
        
        const update = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Easing function
            const easeOut = 1 - Math.pow(1 - progress, 3);
            const current = start + (diff * easeOut);
            
            element.textContent = Math.round(current * 10) / 10;
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        };
        
        requestAnimationFrame(update);
    }

    getActivityIcon(type, severity) {
        switch (type) {
            case 'device_discovered': return 'plus-circle';
            case 'alert': return severity === 'critical' ? 'exclamation-triangle-fill' : 'info-circle';
            default: return 'circle';
        }
    }

    getSeverityClass(severity) {
        switch (severity) {
            case 'critical': return 'text-danger';
            case 'warning': return 'text-warning';
            case 'info': return 'text-info';
            default: return 'text-primary';
        }
    }

    timeAgo(date) {
        const now = new Date();
        const seconds = Math.floor((now - date) / 1000);
        
        const intervals = [
            { label: 'year', seconds: 31536000 },
            { label: 'month', seconds: 2592000 },
            { label: 'day', seconds: 86400 },
            { label: 'hour', seconds: 3600 },
            { label: 'minute', seconds: 60 }
        ];
        
        for (const interval of intervals) {
            const count = Math.floor(seconds / interval.seconds);
            if (count >= 1) {
                return `${count} ${interval.label}${count > 1 ? 's' : ''} ago`;
            }
        }
        
        return 'just now';
    }

    setupEventListeners() {
        // Add any additional event listeners here
    }

    startAutoRefresh() {
        // Refresh every 30 seconds
        this.refreshInterval = setInterval(() => {
            this.refreshHealthScore();
        }, 30000);
    }

    async refreshHealthScore() {
        try {
            const response = await fetch('/api/health/score');
            const data = await response.json();
            
            if (data.success) {
                // Quick update just the health score
                document.getElementById('health-score-value').textContent = data.health_score;
            }
        } catch (error) {
            console.error('Error refreshing health score:', error);
        }
    }

    refreshAll() {
        this.loadHealthData();
        this.loadTopologyData();
    }

    async loadTopologyData() {
        try {
            const response = await fetch('/api/health/topology');
            const data = await response.json();
            
            if (data.success) {
                this.renderTopology(data.devices);
            } else {
                console.error('Failed to load topology data:', data.error);
            }
        } catch (error) {
            console.error('Error loading topology data:', error);
        }
    }

    renderTopology(devices) {
        const container = document.getElementById('network-topology');
        const loadingElement = container.parentElement.querySelector('.topology-loading');
        
        // Hide loading indicator
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
        
        // Clear existing content
        container.innerHTML = '';
        
        if (!devices || devices.length === 0) {
            container.innerHTML = '<div class="text-center py-4 text-muted">No devices found</div>';
            return;
        }

        // Create a simple grid layout for devices
        const gridContainer = document.createElement('div');
        gridContainer.className = 'topology-grid';
        
        // Calculate grid dimensions
        const deviceCount = devices.length;
        const cols = Math.ceil(Math.sqrt(deviceCount));
        const rows = Math.ceil(deviceCount / cols);
        
        gridContainer.style.display = 'grid';
        gridContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        gridContainer.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
        gridContainer.style.gap = '15px';
        gridContainer.style.padding = '20px';
        gridContainer.style.height = '100%';
        
        devices.forEach((device, index) => {
            const deviceElement = this.createTopologyDevice(device);
            gridContainer.appendChild(deviceElement);
        });
        
        container.appendChild(gridContainer);
    }

    createTopologyDevice(device) {
        const deviceDiv = document.createElement('div');
        deviceDiv.className = `topology-device topology-device-${device.status}`;
        deviceDiv.title = `${device.name}\n${device.ip_address}\nType: ${device.type}\nStatus: ${device.status}`;
        
        // Device icon based on type
        const icon = this.getDeviceIcon(device.type);
        
        deviceDiv.innerHTML = `
            <div class="topology-device-icon">
                <i class="bi bi-${icon}"></i>
            </div>
            <div class="topology-device-status ${device.status}"></div>
            <div class="topology-device-name">${device.name}</div>
        `;
        
        // Add click handler for device details
        deviceDiv.addEventListener('click', () => {
            window.location.href = `/device/${device.id}`;
        });
        
        return deviceDiv;
    }

    getDeviceIcon(deviceType) {
        const iconMap = {
            'router': 'router',
            'switch': 'hdd-network',
            'computer': 'laptop',
            'phone': 'phone',
            'tablet': 'tablet',
            'iot': 'cpu',
            'printer': 'printer',
            'camera': 'camera',
            'tv': 'tv',
            'gaming': 'controller',
            'unknown': 'question-circle'
        };
        
        return iconMap[deviceType] || iconMap['unknown'];
    }

    showError(message) {
        // Simple error display - could be enhanced with toast notifications
        console.error(message);
    }
}

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', function() {
    window.healthDashboard = new HealthOverviewDashboard();
});

// Global functions for button actions
function dismissCriticalBanner() {
    document.getElementById('critical-alerts-banner').style.display = 'none';
}

function viewAllAlerts() {
    window.location.href = '/alerts';
}

function refreshTopology() {
    if (window.healthDashboard) {
        window.healthDashboard.loadTopologyData();
    }
}

function toggleTopologyLayout() {
    // Implement layout toggle
    console.log('Toggling topology layout...');
}

async function triggerNetworkScan() {
    try {
        const response = await fetch('/api/monitoring/scan', { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            alert('Network scan initiated successfully!');
        } else {
            alert('Failed to start network scan: ' + result.error);
        }
    } catch (error) {
        alert('Error starting network scan: ' + error.message);
    }
}

async function pingAllDevices() {
    try {
        const response = await fetch('/api/monitoring/ping-all', { method: 'POST' });
        const result = await response.json();
        
        if (result.success) {
            alert('Ping all devices initiated successfully!');
        } else {
            alert('Failed to ping devices: ' + result.error);
        }
    } catch (error) {
        alert('Error pinging devices: ' + error.message);
    }
}
</script>
{% endblock %}

{% block extra_css %}
<style>
/* Health Overview Dashboard Styles */
.health-hero-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.health-score-circle {
    position: relative;
    display: inline-block;
}

.health-circle-svg {
    transform: rotate(-90deg);
}

.health-circle-progress {
    transition: stroke-dashoffset 1.5s ease-in-out;
}

.health-score-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: white;
}

.health-score-number {
    font-size: 3rem;
    font-weight: bold;
    line-height: 1;
}

.health-score-label {
    font-size: 1rem;
    opacity: 0.9;
    margin-top: 0.5rem;
}

/* Network Pulse Animation */
.network-pulse {
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
}

.pulse-dot {
    width: 12px;
    height: 12px;
    background: #28a745;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
    }
}

/* Status Metric Cards */
.status-metric-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: pointer;
}

.status-metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}

.metric-icon {
    opacity: 0.8;
}

.metric-value {
    font-size: 2rem;
    font-weight: bold;
    line-height: 1;
    margin: 0.5rem 0;
}

.metric-unit {
    font-size: 0.8rem;
    opacity: 0.7;
}

.metric-label {
    font-size: 0.9rem;
    color: #6c757d;
    font-weight: 500;
}

.metric-percentage,
.metric-trend {
    font-size: 0.8rem;
    margin-top: 0.25rem;
}

/* Uptime Bar */
.uptime-bar {
    width: 100%;
    height: 6px;
    background-color: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.uptime-bar-fill {
    height: 100%;
    transition: width 1s ease-in-out;
    border-radius: 3px;
}

/* Activity Feed */
.activity-feed {
    max-height: 400px;
    overflow-y: auto;
    padding: 1rem;
}

.activity-item {
    display: flex;
    align-items: flex-start;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f8f9fa;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.75rem;
    flex-shrink: 0;
}

.activity-content {
    flex-grow: 1;
    min-width: 0;
}

.activity-message {
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 0.25rem;
}

.activity-time {
    font-size: 0.75rem;
    color: #6c757d;
}

/* Critical Alerts Banner Animation */
.animate-pulse {
    animation: alertPulse 1s infinite;
}

@keyframes alertPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

/* Activity Status Badge */
.activity-pulse {
    animation: badgePulse 2s infinite;
}

@keyframes badgePulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
}

/* Connection Status */
.connection-indicator {
    animation: connectionPulse 3s infinite;
}

@keyframes connectionPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}

/* Topology Container */
.topology-container {
    height: 300px;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    background: #f8f9fa;
    position: relative;
    overflow: hidden;
}

.network-topology {
    width: 100%;
    height: 100%;
}

/* Purple color for bandwidth metric */
.text-purple {
    color: #6f42c1 !important;
}

/* Network Topology Styles */
.topology-grid {
    display: grid;
    gap: 15px;
    padding: 20px;
    height: 100%;
    align-items: center;
    justify-items: center;
}

.topology-device {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px;
    border-radius: 12px;
    background: white;
    border: 2px solid #e9ecef;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 80px;
    max-width: 100px;
    text-align: center;
    position: relative;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.topology-device:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 10;
}

.topology-device-online {
    border-color: #28a745;
    background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
}

.topology-device-offline {
    border-color: #dc3545;
    background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
}

.topology-device-icon {
    font-size: 1.5rem;
    margin-bottom: 8px;
    color: #495057;
}

.topology-device-online .topology-device-icon {
    color: #28a745;
}

.topology-device-offline .topology-device-icon {
    color: #dc3545;
}

.topology-device-status {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-bottom: 6px;
    animation: devicePulse 2s infinite;
}

.topology-device-status.online {
    background-color: #28a745;
}

.topology-device-status.offline {
    background-color: #dc3545;
    animation: deviceAlarm 1s infinite;
}

.topology-device-name {
    font-size: 0.75rem;
    font-weight: 500;
    color: #495057;
    line-height: 1.2;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

@keyframes devicePulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.1); }
}

@keyframes deviceAlarm {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .health-score-circle svg {
        width: 150px;
        height: 150px;
    }
    
    .health-score-number {
        font-size: 2rem;
    }
    
    .metric-value {
        font-size: 1.5rem;
    }
}
</style>
{% endblock %}