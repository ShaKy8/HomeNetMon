{% extends "base_beautiful.html" %}

{% block title %}Settings - HomeNetMon{% endblock %}

{% block extra_css %}
<style>
/* Settings-specific styles */

/* Settings Layout */
.settings-container {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

/* Settings Navigation */
.settings-nav {
    position: sticky;
    top: 6rem;
    height: fit-content;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1rem;
    backdrop-filter: blur(20px);
}

.settings-nav-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.3s ease;
    margin-bottom: 0.25rem;
    font-weight: 500;
}

.settings-nav-item:hover {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.9);
    transform: translateX(4px);
}

.settings-nav-item.active {
    background: rgba(59, 130, 246, 0.2);
    color: #ffffff;
    border: 1px solid rgba(59, 130, 246, 0.3);
}

.settings-nav-item i {
    font-size: 1.1rem;
    opacity: 0.8;
}

/* Settings Content */
.settings-content {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 2rem;
    backdrop-filter: blur(20px);
}

.settings-section {
    display: none;
}

.settings-section.active {
    display: block;
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.section-title {
    font-size: 1.75rem;
    font-weight: 300;
    margin-bottom: 1.5rem;
    color: #ffffff;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 0.75rem;
}

/* Form Groups */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group:last-child {
    margin-bottom: 0;
}

.form-text {
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.6);
    margin-top: 0.5rem;
    line-height: 1.4;
}

/* Input Groups */
.input-group {
    display: flex;
    align-items: stretch;
    gap: 0;
}

.input-group .form-control {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
    border-right: none;
}

.input-group .btn-group {
    display: flex;
}

.input-group .btn-group .btn {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    border-left: none;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.8);
    padding: 0.5rem 0.75rem;
    font-size: 0.8rem;
    transition: all 0.3s ease;
}

.input-group .btn-group .btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
}

.input-group .btn-group .btn:not(:last-child) {
    border-right: 1px solid rgba(255, 255, 255, 0.1);
}

/* Info Cards */
.info-card {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
}

.info-card h6 {
    color: #93c5fd;
    margin-bottom: 0.75rem;
    font-weight: 600;
}

.info-card p {
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 0.5rem;
}

.info-card ul {
    color: rgba(255, 255, 255, 0.7);
    padding-left: 1.25rem;
}

.info-card ul li {
    margin-bottom: 0.25rem;
}

.alert-info {
    background: rgba(59, 130, 246, 0.1);
    border-color: rgba(59, 130, 246, 0.3);
}

.alert-warning {
    background: rgba(245, 158, 11, 0.1);
    border-color: rgba(245, 158, 11, 0.3);
}

.alert-warning h6 {
    color: #fcd34d;
}

.alert-success {
    background: rgba(34, 197, 94, 0.1);
    border-color: rgba(34, 197, 94, 0.3);
}

.alert-success h6 {
    color: #86efac;
}

/* Toggle Switches */
.form-check {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
}

.form-check-input {
    width: 3rem;
    height: 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 0.75rem;
    margin-right: 0.75rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.form-check-input:checked {
    background: rgba(34, 197, 94, 0.3);
    border-color: rgba(34, 197, 94, 0.5);
}

.form-check-label {
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
    cursor: pointer;
}

/* Button Groups */
.btn-group {
    display: flex;
    gap: 0.5rem;
}

.btn-group .btn {
    flex: 1;
}

/* Action Buttons */
.settings-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* Status Indicators */
.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
}

.status-connected {
    background: rgba(34, 197, 94, 0.2);
    color: #86efac;
    border: 1px solid rgba(34, 197, 94, 0.3);
}

.status-disconnected {
    background: rgba(239, 68, 68, 0.2);
    color: #fca5a5;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
    .settings-container {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .settings-nav {
        position: static;
        display: flex;
        overflow-x: auto;
        padding: 0.75rem;
        gap: 0.5rem;
    }

    .settings-nav-item {
        white-space: nowrap;
        margin-bottom: 0;
        flex-shrink: 0;
    }

    .settings-content {
        padding: 1.5rem;
    }

    .settings-actions {
        flex-direction: column;
    }

    .input-group {
        flex-direction: column;
        gap: 0.5rem;
    }

    .input-group .form-control {
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .input-group .btn-group {
        justify-content: center;
    }

    .input-group .btn-group .btn {
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="page-header">
    <h1 class="page-title">⚙️ Settings</h1>
    <p class="page-subtitle">Configure HomeNetMon to monitor your network the way you want</p>
</div>

<!-- Settings Layout -->
<div class="settings-container">
    <!-- Settings Navigation -->
    <div class="settings-nav">
        <a href="#network" class="settings-nav-item active" data-section="network">
            <i class="bi bi-router"></i>
            Network
        </a>
        <a href="#interface" class="settings-nav-item" data-section="interface">
            <i class="bi bi-palette"></i>
            Interface
        </a>
        <a href="#alerts" class="settings-nav-item" data-section="alerts">
            <i class="bi bi-bell"></i>
            Alerts
        </a>
        <a href="#system" class="settings-nav-item" data-section="system">
            <i class="bi bi-gear"></i>
            System
        </a>
        <a href="#about" class="settings-nav-item" data-section="about">
            <i class="bi bi-info-circle"></i>
            About
        </a>
    </div>

    <!-- Settings Content -->
    <div class="settings-content">
        <!-- Network Settings -->
        <div class="settings-section active" id="network">
            <h2 class="section-title">Network Configuration</h2>

            <form id="network-settings-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="form-group">
                    <label for="network-range" class="form-label">
                        <i class="bi bi-globe me-2"></i>Network Range to Monitor
                    </label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="network-range" placeholder="192.168.86.0/24">
                        <div class="btn-group">
                            <button type="button" class="btn btn-sm" onclick="setNetworkRange('192.168.1.0/24')">192.168.1.x</button>
                            <button type="button" class="btn btn-sm" onclick="setNetworkRange('192.168.86.0/24')">192.168.86.x</button>
                            <button type="button" class="btn btn-sm" onclick="setNetworkRange('10.0.0.0/24')">10.0.0.x</button>
                        </div>
                    </div>
                    <div class="form-text">
                        CIDR notation for the network range to monitor (e.g., 192.168.1.0/24 monitors 192.168.1.1-254)
                    </div>
                </div>

                <div class="info-card alert-info">
                    <h6><i class="bi bi-info-circle me-2"></i>Automatic Monitoring Settings</h6>
                    <p class="mb-2">HomeNetMon continuously monitors your network in the background. Configure how frequently monitoring operations run:</p>
                    <ul class="mb-0">
                        <li><strong>Ping Interval:</strong> How often to check if devices are online</li>
                        <li><strong>Scan Interval:</strong> How often to discover new devices</li>
                    </ul>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="ping-interval" class="form-label">
                                <i class="bi bi-broadcast me-2"></i>Ping Interval (seconds)
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="ping-interval" min="5" max="900">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm" onclick="setPingInterval(30)">30s</button>
                                    <button type="button" class="btn btn-sm" onclick="setPingInterval(60)">1m</button>
                                    <button type="button" class="btn btn-sm" onclick="setPingInterval(300)">5m</button>
                                </div>
                            </div>
                            <div class="form-text">How often to ping all monitored devices (5-900 seconds)</div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="scan-interval" class="form-label">
                                <i class="bi bi-search me-2"></i>Scan Interval (seconds)
                            </label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="scan-interval" min="60" max="3600">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm" onclick="setScanInterval(300)">5m</button>
                                    <button type="button" class="btn btn-sm" onclick="setScanInterval(900)">15m</button>
                                    <button type="button" class="btn btn-sm" onclick="setScanInterval(1800)">30m</button>
                                </div>
                            </div>
                            <div class="form-text">How often to scan for new devices (60-3600 seconds)</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-2"></i>Save Network Settings
                    </button>
                </div>
            </form>

            <div class="settings-actions">
                <button type="button" class="btn-modern" onclick="resetNetworkSettings()">
                    <i class="bi bi-arrow-clockwise"></i> Reset
                </button>
                <button type="button" class="btn-modern btn-primary" onclick="saveNetworkSettings()">
                    <i class="bi bi-save"></i> Save Changes
                </button>
            </div>
        </div>

        <!-- Interface Settings -->
        <div class="settings-section" id="interface">
            <h2 class="section-title">Interface Preferences</h2>

            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-palette me-2"></i>Dashboard Title
                </label>
                <input type="text" class="form-control" id="dashboard-title" placeholder="Home Network Monitor">
                <div class="form-text">Custom title for your dashboard</div>
            </div>

            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="auto-refresh">
                    <label class="form-check-label" for="auto-refresh">
                        Auto-refresh dashboard data
                    </label>
                </div>
                <div class="form-text">Automatically update device status every 30 seconds</div>
            </div>

            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="show-offline">
                    <label class="form-check-label" for="show-offline">
                        Show offline devices
                    </label>
                </div>
                <div class="form-text">Display devices that are currently offline</div>
            </div>

            <div class="settings-actions">
                <button type="button" class="btn-modern" onclick="resetInterfaceSettings()">
                    <i class="bi bi-arrow-clockwise"></i> Reset
                </button>
                <button type="button" class="btn-modern btn-primary" onclick="saveInterfaceSettings()">
                    <i class="bi bi-save"></i> Save Changes
                </button>
            </div>
        </div>

        <!-- Alerts Settings -->
        <div class="settings-section" id="alerts">
            <h2 class="section-title">Alert Configuration</h2>

            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="enable-alerts">
                    <label class="form-check-label" for="enable-alerts">
                        Enable alert notifications
                    </label>
                </div>
                <div class="form-text">Send notifications when devices go offline or come online</div>
            </div>

            <div class="form-group">
                <label for="alert-threshold" class="form-label">
                    <i class="bi bi-clock me-2"></i>Alert Threshold (minutes)
                </label>
                <div class="input-group">
                    <input type="number" class="form-control" id="alert-threshold" min="1" max="60">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm" onclick="setAlertThreshold(5)">5m</button>
                        <button type="button" class="btn btn-sm" onclick="setAlertThreshold(15)">15m</button>
                        <button type="button" class="btn btn-sm" onclick="setAlertThreshold(30)">30m</button>
                    </div>
                </div>
                <div class="form-text">How long to wait before sending an alert for offline devices</div>
            </div>

            <div class="settings-actions">
                <button type="button" class="btn-modern" onclick="resetAlertSettings()">
                    <i class="bi bi-arrow-clockwise"></i> Reset
                </button>
                <button type="button" class="btn-modern btn-primary" onclick="saveAlertSettings()">
                    <i class="bi bi-save"></i> Save Changes
                </button>
            </div>
        </div>

        <!-- System Settings -->
        <div class="settings-section" id="system">
            <h2 class="section-title">System Information</h2>

            <div class="info-card alert-info">
                <h6><i class="bi bi-info-circle me-2"></i>System Status</h6>
                <p>HomeNetMon is running and monitoring your network.</p>
                <div class="status-indicator status-connected">
                    <i class="bi bi-check-circle"></i>
                    Service Running
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Version Information</label>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="info-card">
                            <h6>Application Version</h6>
                            <p class="mb-0">HomeNetMon v2.0</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-card">
                            <h6>Python Version</h6>
                            <p class="mb-0" id="python-version">Loading...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-actions">
                <button type="button" class="btn-modern btn-warning" onclick="restartService()">
                    <i class="bi bi-arrow-clockwise"></i> Restart Service
                </button>
                <button type="button" class="btn-modern btn-danger" onclick="clearAllData()">
                    <i class="bi bi-trash"></i> Clear All Data
                </button>
            </div>
        </div>

        <!-- About Settings -->
        <div class="settings-section" id="about">
            <h2 class="section-title">About HomeNetMon</h2>

            <div class="info-card alert-success">
                <h6><i class="bi bi-house me-2"></i>Welcome to HomeNetMon</h6>
                <p>A comprehensive home network monitoring solution designed to keep track of all devices on your network.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Features</label>
                <ul style="color: rgba(255, 255, 255, 0.8); line-height: 1.6;">
                    <li>Real-time device monitoring and status tracking</li>
                    <li>Automatic network discovery and scanning</li>
                    <li>Configurable alerts and notifications</li>
                    <li>Historical data tracking and analytics</li>
                    <li>Beautiful and responsive web interface</li>
                    <li>Progressive Web App (PWA) support</li>
                </ul>
            </div>

            <div class="settings-actions">
                <a href="https://github.com/your-repo/homenetmon" class="btn-modern" target="_blank">
                    <i class="bi bi-github"></i> View on GitHub
                </a>
                <button type="button" class="btn-modern btn-primary" onclick="checkForUpdates()">
                    <i class="bi bi-download"></i> Check for Updates
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Settings page functionality
document.addEventListener('DOMContentLoaded', function() {
    // Load current settings
    loadCurrentSettings();

    // Setup navigation
    setupSettingsNavigation();

    // Load system information
    loadSystemInfo();
});

function setupSettingsNavigation() {
    const navItems = document.querySelectorAll('.settings-nav-item');
    const sections = document.querySelectorAll('.settings-section');

    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();

            const targetSection = this.getAttribute('data-section');

            // Update active states
            navItems.forEach(nav => nav.classList.remove('active'));
            sections.forEach(section => section.classList.remove('active'));

            this.classList.add('active');
            document.getElementById(targetSection).classList.add('active');

            // Update URL hash
            window.location.hash = targetSection;
        });
    });

    // Handle initial hash
    const hash = window.location.hash.substring(1);
    if (hash && document.getElementById(hash)) {
        navItems.forEach(nav => nav.classList.remove('active'));
        sections.forEach(section => section.classList.remove('active'));

        document.querySelector(`[data-section="${hash}"]`).classList.add('active');
        document.getElementById(hash).classList.add('active');
    }
}

async function loadCurrentSettings() {
    try {
        const response = await fetch('/api/config');
        const config = await response.json();

        // Populate form fields
        if (config.network_range) {
            document.getElementById('network-range').value = config.network_range;
        }
        if (config.ping_interval) {
            document.getElementById('ping-interval').value = config.ping_interval;
        }
        if (config.scan_interval) {
            document.getElementById('scan-interval').value = config.scan_interval;
        }
        if (config.dashboard_title) {
            document.getElementById('dashboard-title').value = config.dashboard_title;
        }
        if (config.alert_threshold) {
            document.getElementById('alert-threshold').value = config.alert_threshold;
        }

        // Set checkboxes
        document.getElementById('auto-refresh').checked = config.auto_refresh || false;
        document.getElementById('show-offline').checked = config.show_offline || true;
        document.getElementById('enable-alerts').checked = config.enable_alerts || true;

    } catch (error) {
        console.error('Error loading settings:', error);
    }
}

async function loadSystemInfo() {
    try {
        const response = await fetch('/api/system/info');
        const info = await response.json();

        if (info.python_version) {
            document.getElementById('python-version').textContent = info.python_version;
        }
    } catch (error) {
        console.error('Error loading system info:', error);
        document.getElementById('python-version').textContent = 'Unknown';
    }
}

// Network Settings Functions
function setNetworkRange(range) {
    document.getElementById('network-range').value = range;
}

function setPingInterval(interval) {
    document.getElementById('ping-interval').value = interval;
}

function setScanInterval(interval) {
    document.getElementById('scan-interval').value = interval;
}

async function saveNetworkSettings() {
    const networkRange = document.getElementById('network-range').value;
    const pingInterval = document.getElementById('ping-interval').value;
    const scanInterval = document.getElementById('scan-interval').value;

    try {
        const response = await fetch('/api/config', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                network_range: networkRange,
                ping_interval: parseInt(pingInterval),
                scan_interval: parseInt(scanInterval)
            })
        });

        if (response.ok) {
            showSuccess('Network settings saved successfully');
        } else {
            showError('Failed to save network settings');
        }
    } catch (error) {
        console.error('Error saving network settings:', error);
        showError('Error saving network settings');
    }
}

function resetNetworkSettings() {
    document.getElementById('network-range').value = '192.168.86.0/24';
    document.getElementById('ping-interval').value = '60';
    document.getElementById('scan-interval').value = '300';
}

// Interface Settings Functions
async function saveInterfaceSettings() {
    const dashboardTitle = document.getElementById('dashboard-title').value;
    const autoRefresh = document.getElementById('auto-refresh').checked;
    const showOffline = document.getElementById('show-offline').checked;

    try {
        const response = await fetch('/api/config', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                dashboard_title: dashboardTitle,
                auto_refresh: autoRefresh,
                show_offline: showOffline
            })
        });

        if (response.ok) {
            showSuccess('Interface settings saved successfully');
        } else {
            showError('Failed to save interface settings');
        }
    } catch (error) {
        console.error('Error saving interface settings:', error);
        showError('Error saving interface settings');
    }
}

function resetInterfaceSettings() {
    document.getElementById('dashboard-title').value = 'Home Network Monitor';
    document.getElementById('auto-refresh').checked = true;
    document.getElementById('show-offline').checked = true;
}

// Alert Settings Functions
function setAlertThreshold(threshold) {
    document.getElementById('alert-threshold').value = threshold;
}

async function saveAlertSettings() {
    const enableAlerts = document.getElementById('enable-alerts').checked;
    const alertThreshold = document.getElementById('alert-threshold').value;

    try {
        const response = await fetch('/api/config', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                enable_alerts: enableAlerts,
                alert_threshold: parseInt(alertThreshold)
            })
        });

        if (response.ok) {
            showSuccess('Alert settings saved successfully');
        } else {
            showError('Failed to save alert settings');
        }
    } catch (error) {
        console.error('Error saving alert settings:', error);
        showError('Error saving alert settings');
    }
}

function resetAlertSettings() {
    document.getElementById('enable-alerts').checked = true;
    document.getElementById('alert-threshold').value = '15';
}

// System Functions
async function restartService() {
    if (confirm('Are you sure you want to restart the HomeNetMon service?')) {
        try {
            const response = await fetch('/api/system/restart', { method: 'POST' });
            if (response.ok) {
                showSuccess('Service restart initiated');
            } else {
                showError('Failed to restart service');
            }
        } catch (error) {
            console.error('Error restarting service:', error);
            showError('Error restarting service');
        }
    }
}

async function clearAllData() {
    if (confirm('Are you sure you want to clear all monitoring data? This cannot be undone.')) {
        try {
            const response = await fetch('/api/system/clear-data', { method: 'POST' });
            if (response.ok) {
                showSuccess('All data cleared successfully');
            } else {
                showError('Failed to clear data');
            }
        } catch (error) {
            console.error('Error clearing data:', error);
            showError('Error clearing data');
        }
    }
}

async function checkForUpdates() {
    showSuccess('You are running the latest version of HomeNetMon');
}

// Utility functions
function showSuccess(message) {
    // Create a temporary success message
    const alert = document.createElement('div');
    alert.className = 'alert alert-success';
    alert.textContent = message;
    alert.style.position = 'fixed';
    alert.style.top = '90px';
    alert.style.right = '20px';
    alert.style.zIndex = '9999';
    alert.style.minWidth = '300px';

    document.body.appendChild(alert);

    setTimeout(() => {
        document.body.removeChild(alert);
    }, 3000);
}

function showError(message) {
    // Create a temporary error message
    const alert = document.createElement('div');
    alert.className = 'alert alert-danger';
    alert.textContent = message;
    alert.style.position = 'fixed';
    alert.style.top = '90px';
    alert.style.right = '20px';
    alert.style.zIndex = '9999';
    alert.style.minWidth = '300px';

    document.body.appendChild(alert);

    setTimeout(() => {
        document.body.removeChild(alert);
    }, 3000);
}
</script>
{% endblock %}